<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>R-TYPE: Packaging &lt;tt&gt;.zip&lt;/tt&gt; Files Example: zlib</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">R-TYPE
   </div>
   <div id="projectbrief">Shoot&#39;em up game</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Packaging <code>.zip</code> Files Example: zlib </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="autotoc_md307"></a>
Bootstrap with &lt;tt&gt;create&lt;/tt&gt;</h2>
<p>First, locate a globally accessible archive of the library's sources. Zip, gzip, and bzip are all supported. Strongly prefer official sources or mirrors over unofficial mirrors.</p>
<p><em>Looking at zlib's website, the URL <a href="http://zlib.net/zlib-1.2.12.tar.gz">http://zlib.net/zlib-1.2.12.tar.gz</a> looks appropriate.</em></p>
<p>Second, determine a suitable package name. This should be ASCII, lowercase, and recognizable to someone who knows the library's "human name". If the library is already packaged in another package manager, prefer that name.</p>
<p><em>Since zlib is already packaged as zlib, we will use the name zlib2 for this example.</em></p>
<p>Finally, if the server's name for the archive is not very descriptive (such as downloading a zipped commit or branch from GitHub), choose a nice archive name of the form <code>&lt;packagename&gt;-&lt;version&gt;.zip</code>.</p>
<p>*<code>zlib1212.zip</code> is a fine name, so no change needed.*</p>
<p>All this information can then be passed into the <code>create</code> command, which will download the sources and bootstrap the packaging process inside <code>ports/&lt;packagename&gt;</code>.</p>
<div class="fragment"><div class="line">PS D:\src\vcpkg&gt; .\vcpkg create zlib2 http://zlib.net/zlib-1.2.12.tar.gz zlib1212.tar.gz</div>
<div class="line">-- Generated portfile: D:/src/vcpkg/ports/zlib2/portfile.cmake</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md308"></a>
Create the manifest file</h2>
<p>In addition to the generated <code>ports/&lt;package&gt;/portfile.cmake</code>, we also need a <code>ports/&lt;package&gt;/vcpkg.json</code> file. This file is a simple set of fields describing the package's metadata.</p>
<p><em>For zlib2, we'll create the file <code>ports/zlib2/vcpkg.json</code> with the following contents:</em> </p><div class="fragment"><div class="line">{</div>
<div class="line">  &quot;name&quot;: &quot;zlib2&quot;,</div>
<div class="line">  &quot;version-string&quot;: &quot;1.2.12&quot;,</div>
<div class="line">  &quot;description&quot;: &quot;A Massively Spiffy Yet Delicately Unobtrusive Compression Library&quot;</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md309"></a>
Tweak the generated portfile</h2>
<p>The generated <code>portfile.cmake</code> will need some editing to correctly package most libraries in the wild, however we can start by trying out the build.</p>
<div class="fragment"><div class="line">PS D:\src\vcpkg&gt; .\vcpkg install zlib2</div>
<div class="line">Computing installation plan...</div>
<div class="line">The following packages will be built and installed:</div>
<div class="line">    zlib2[core]:x64-uwp</div>
<div class="line">Starting package 1/1: zlib2:x64-uwp</div>
<div class="line">Building package zlib2[core]:x64-uwp...</div>
<div class="line">-- Using cached C:/src/vcpkg/downloads/zlib1212.tar.gz</div>
<div class="line">-- Cleaning sources at C:/src/vcpkg/buildtrees/zlib2/src/1.2.12-deec42f53b.clean. Pass --editable to vcpkg to reuse sources.</div>
<div class="line">-- Extracting source C:/src/vcpkg/downloads/zlib1212.tar.gz</div>
<div class="line">-- Applying patch cmake_dont_build_more_than_needed.patch</div>
<div class="line">-- Using source at C:/src/vcpkg/buildtrees/zlib2/src/1.2.12-deec42f53b.clean</div>
<div class="line">-- Configuring x64-uwp</div>
<div class="line">-- Building x64-uwp-dbg</div>
<div class="line">-- Building x64-uwp-rel</div>
<div class="line">-- Installing: C:/src/vcpkg/packages/zlib2_x64-uwp/share/zlib2/copyright</div>
<div class="line">-- Performing post-build validation</div>
<div class="line">Include files should not be duplicated into the /debug/include directory. If this cannot be disabled in the project cmake, use</div>
<div class="line">    file(REMOVE_RECURSE ${CURRENT_PACKAGES_DIR}/debug/include)</div>
<div class="line">/debug/share should not exist. Please reorganize any important files, then use</div>
<div class="line">    file(REMOVE_RECURSE ${CURRENT_PACKAGES_DIR}/debug/share)</div>
<div class="line">The software license must be available at ${CURRENT_PACKAGES_DIR}/share/zlib2/copyright</div>
<div class="line">Found 3 error(s). Please correct the portfile:</div>
<div class="line">    D:\src\vcpkg\ports\zlib2\portfile.cmake</div>
</div><!-- fragment --><p>At this point, it is a matter of reading the error messages and log files while steadily improving the quality of the portfile. Zlib required providing a discrete copy of the LICENSE to copy into the package, suppressing the build and installation of executables and headers, and removing the static libraries after they were installed.</p>
<h2><a class="anchor" id="autotoc_md310"></a>
Suggested example portfiles</h2>
<p>In the <code>ports/</code> directory are many libraries that can be used as examples, including many that are not based on CMake.</p>
<ul>
<li>Header only libraries<ul>
<li>rapidjson</li>
<li>range-v3</li>
</ul>
</li>
<li>MSBuild-based<ul>
<li>mpg123</li>
</ul>
</li>
<li>Non-CMake, custom buildsystem<ul>
<li>openssl</li>
<li>ffmpeg </li>
</ul>
</li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
